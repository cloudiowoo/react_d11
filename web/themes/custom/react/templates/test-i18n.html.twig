<!DOCTYPE html>
<html lang="{{ language.id }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤šè¯­è¨€æµ‹è¯• - Homtime</title>

  {# åŠ è½½ React åº”ç”¨çš„ CSS å’Œ JS #}
  {{ attach_library('homtime/react-app') }}

  <style>
    body {
      font-family: 'Roboto', 'Noto Sans CJK SC', 'PingFang SC', 'Microsoft YaHei', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .language-info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      border-left: 4px solid #2196f3;
    }

    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
    }

    .test-section h3 {
      margin-top: 0;
      color: #1976d2;
    }

    .react-container {
      min-height: 200px;
      border: 2px dashed #ccc;
      padding: 20px;
      border-radius: 5px;
      margin: 10px 0;
    }

    .demo-button {
      background: #1976d2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }

    .demo-button:hover {
      background: #1565c0;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸŒ Homtime å¤šè¯­è¨€åŠŸèƒ½æµ‹è¯•</h1>

    <div class="language-info">
      <h3>å½“å‰è¯­è¨€ä¿¡æ¯</h3>
      <p><strong>Drupal è¯­è¨€ä»£ç :</strong> {{ language.id }}</p>
      <p><strong>è¯­è¨€åç§°:</strong> {{ language.name }}</p>
      <p><strong>URL å‰ç¼€:</strong> {{ language.prefix }}</p>
      <p><strong>æ–¹å‘:</strong> {{ language.direction }}</p>
    </div>

    <div class="test-section">
      <h3>1. è¯­è¨€åˆ‡æ¢å™¨æµ‹è¯•</h3>
      <p>ä¸‹é¢çš„ç»„ä»¶åº”è¯¥æ˜¾ç¤ºå½“å‰è¯­è¨€å¹¶å…è®¸åˆ‡æ¢åˆ°å…¶ä»–è¯­è¨€ï¼š</p>
      <div id="language-switcher-test" class="react-container">
        <p>æ­£åœ¨åŠ è½½è¯­è¨€åˆ‡æ¢å™¨...</p>
      </div>
    </div>

    <div class="test-section">
      <h3>2. ç¿»è¯‘æ–‡æœ¬æµ‹è¯•</h3>
      <p>ä¸‹é¢å°†æ˜¾ç¤ºå„ç§ç¿»è¯‘æ–‡æœ¬ï¼š</p>
      <div id="translation-test" class="react-container">
        <p>æ­£åœ¨åŠ è½½ç¿»è¯‘æµ‹è¯•...</p>
      </div>
    </div>

    <div class="test-section">
      <h3>3. äº§å“ä¿¡æ¯æµ‹è¯•</h3>
      <p>æµ‹è¯•äº§å“ä¿¡æ¯çš„å¤šè¯­è¨€æ˜¾ç¤ºï¼š</p>
      <div id="product-test" class="react-container">
        <p>æ­£åœ¨åŠ è½½äº§å“æµ‹è¯•...</p>
      </div>
    </div>

    <div class="test-section">
      <h3>4. æ ¼å¼åŒ–æµ‹è¯•</h3>
      <p>æµ‹è¯•æ•°å­—ã€è´§å¸å’Œæ—¥æœŸçš„æœ¬åœ°åŒ–æ ¼å¼ï¼š</p>
      <div id="format-test" class="react-container">
        <p>æ­£åœ¨åŠ è½½æ ¼å¼åŒ–æµ‹è¯•...</p>
      </div>
    </div>

    <div class="test-section">
      <h3>5. å®Œæ•´åº”ç”¨æµ‹è¯•</h3>
      <p>åŠ è½½å®Œæ•´çš„ Homtime React åº”ç”¨ï¼š</p>
      <button class="demo-button" onclick="loadFullApp()">åŠ è½½å®Œæ•´åº”ç”¨</button>
      <div id="full-app-test" class="react-container" style="min-height: 400px;">
        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½å®Œæ•´åº”ç”¨...</p>
      </div>
    </div>

    <div class="test-section">
      <h3>6. æµ‹è¯•æ“ä½œ</h3>
      <button class="demo-button" onclick="testLanguageSwitch('zh-CN')">åˆ‡æ¢åˆ°ç®€ä½“ä¸­æ–‡</button>
      <button class="demo-button" onclick="testLanguageSwitch('zh-TW')">åˆ‡æ¢åˆ°ç¹é«”ä¸­æ–‡</button>
      <button class="demo-button" onclick="testLanguageSwitch('en')">Switch to English</button>
      <button class="demo-button" onclick="testLanguageSwitch('ja')">æ—¥æœ¬èªã«åˆ‡ã‚Šæ›¿ãˆ</button>
      <button class="demo-button" onclick="testLanguageSwitch('ko')">í•œêµ­ì–´ë¡œ ì „í™˜</button>
    </div>
  </div>

  <script>
    // ç­‰å¾… React åº”ç”¨åŠ è½½
    document.addEventListener('DOMContentLoaded', function() {
      console.log('å¼€å§‹å¤šè¯­è¨€æµ‹è¯•...');

      // æ£€æŸ¥ React åº”ç”¨æ˜¯å¦å·²åŠ è½½
      function checkReactApp() {
        if (typeof window.React !== 'undefined' && window.HomtimeApp) {
          console.log('React åº”ç”¨å·²åŠ è½½ï¼Œå¼€å§‹æ¸²æŸ“æµ‹è¯•ç»„ä»¶...');
          initializeTests();
        } else {
          console.log('ç­‰å¾… React åº”ç”¨åŠ è½½...');
          setTimeout(checkReactApp, 500);
        }
      }

      checkReactApp();
    });

    function initializeTests() {
      // æ¸²æŸ“è¯­è¨€åˆ‡æ¢å™¨æµ‹è¯•
      if (window.HomtimeApp && window.HomtimeApp.LanguageSwitcher) {
        try {
          const languageSwitcherContainer = document.getElementById('language-switcher-test');
          if (languageSwitcherContainer) {
            window.ReactDOM.render(
              window.React.createElement(window.HomtimeApp.LanguageSwitcher, {
                variant: 'button',
                size: 'medium'
              }),
              languageSwitcherContainer
            );
          }
        } catch (error) {
          console.error('è¯­è¨€åˆ‡æ¢å™¨æ¸²æŸ“å¤±è´¥:', error);
        }
      }

      // æ¸²æŸ“ç¿»è¯‘æµ‹è¯•
      renderTranslationTest();

      // æ¸²æŸ“äº§å“æµ‹è¯•
      renderProductTest();

      // æ¸²æŸ“æ ¼å¼åŒ–æµ‹è¯•
      renderFormatTest();
    }

    function renderTranslationTest() {
      const container = document.getElementById('translation-test');
      if (!container) return;

      // ä½¿ç”¨ i18next ç¿»è¯‘
      if (window.i18next) {
        const t = window.i18next.t;
        container.innerHTML = `
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div><strong>å¯¼èˆª.é¦–é¡µ:</strong> ${t('navigation.home')}</div>
            <div><strong>å¯¼èˆª.äº§å“:</strong> ${t('navigation.products')}</div>
            <div><strong>é€šç”¨.åŠ è½½ä¸­:</strong> ${t('common.loading')}</div>
            <div><strong>é€šç”¨.ä¿å­˜:</strong> ${t('common.save')}</div>
            <div><strong>äº§å“.ä»·æ ¼:</strong> ${t('product.price')}</div>
            <div><strong>äº§å“.æ·»åŠ åˆ°è´­ç‰©è½¦:</strong> ${t('product.addToCart')}</div>
          </div>
        `;
      } else {
        container.innerHTML = '<p style="color: red;">i18next æœªåŠ è½½</p>';
      }
    }

    function renderProductTest() {
      const container = document.getElementById('product-test');
      if (!container || !window.i18next) return;

      const t = window.i18next.t;
      container.innerHTML = `
        <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
          <h4>${t('product.featured.mx.name')}</h4>
          <p><strong>${t('product.title')}:</strong> ${t('product.featured.mx.title')}</p>
          <p><strong>${t('product.description')}:</strong> ${t('product.featured.mx.description')}</p>
          <p><strong>${t('product.price')}:</strong> Â¥299</p>
          <button style="background: #4caf50; color: white; border: none; padding: 8px 16px; border-radius: 3px;">
            ${t('product.addToCart')}
          </button>
        </div>
      `;
    }

    function renderFormatTest() {
      const container = document.getElementById('format-test');
      if (!container) return;

      const currentLang = window.i18next ? window.i18next.language : 'zh-CN';
      const testNumber = 1234.56;
      const testDate = new Date();

      try {
        const currencyFormatted = new Intl.NumberFormat(currentLang, {
          style: 'currency',
          currency: getCurrencyForLang(currentLang)
        }).format(testNumber);

        const dateFormatted = new Intl.DateTimeFormat(currentLang, {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        }).format(testDate);

        const numberFormatted = new Intl.NumberFormat(currentLang).format(testNumber);

        container.innerHTML = `
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div><strong>æ•°å­—æ ¼å¼:</strong> ${numberFormatted}</div>
            <div><strong>è´§å¸æ ¼å¼:</strong> ${currencyFormatted}</div>
            <div><strong>æ—¥æœŸæ ¼å¼:</strong> ${dateFormatted}</div>
            <div><strong>å½“å‰è¯­è¨€:</strong> ${currentLang}</div>
          </div>
        `;
      } catch (error) {
        container.innerHTML = `<p style="color: red;">æ ¼å¼åŒ–æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
      }
    }

    function getCurrencyForLang(lang) {
      const currencyMap = {
        'zh-CN': 'CNY',
        'zh-TW': 'TWD',
        'ja': 'JPY',
        'ko': 'KRW',
        'en': 'USD'
      };
      return currencyMap[lang] || 'CNY';
    }

    function testLanguageSwitch(langCode) {
      console.log(`åˆ‡æ¢è¯­è¨€åˆ°: ${langCode}`);

      if (window.i18next) {
        window.i18next.changeLanguage(langCode).then(() => {
          console.log(`è¯­è¨€å·²åˆ‡æ¢åˆ°: ${langCode}`);

          // é‡æ–°æ¸²æŸ“æ‰€æœ‰æµ‹è¯•ç»„ä»¶
          setTimeout(() => {
            renderTranslationTest();
            renderProductTest();
            renderFormatTest();
          }, 100);

          // æ›´æ–°é¡µé¢ä¿¡æ¯
          document.documentElement.lang = langCode;

          // æ›´æ–° URL
          const url = new URL(window.location);
          url.searchParams.set('lang', langCode);
          window.history.replaceState({}, '', url);

        }).catch(error => {
          console.error('è¯­è¨€åˆ‡æ¢å¤±è´¥:', error);
        });
      } else {
        alert('i18next æœªåŠ è½½ï¼Œæ— æ³•åˆ‡æ¢è¯­è¨€');
      }
    }

    function loadFullApp() {
      const container = document.getElementById('full-app-test');
      if (!container) return;

      if (window.HomtimeApp && window.HomtimeApp.App) {
        try {
          container.innerHTML = '<div id="full-app-root"></div>';
          const appRoot = document.getElementById('full-app-root');

          window.ReactDOM.render(
            window.React.createElement(window.HomtimeApp.App),
            appRoot
          );

          console.log('å®Œæ•´åº”ç”¨å·²åŠ è½½');
        } catch (error) {
          console.error('åŠ è½½å®Œæ•´åº”ç”¨å¤±è´¥:', error);
          container.innerHTML = `<p style="color: red;">åŠ è½½å¤±è´¥: ${error.message}</p>`;
        }
      } else {
        container.innerHTML = '<p style="color: red;">React åº”ç”¨æœªåŠ è½½</p>';
      }
    }

    // ç›‘å¬è¯­è¨€å˜åŒ–äº‹ä»¶
    window.addEventListener('languageChanged', function(event) {
      console.log('æ£€æµ‹åˆ°è¯­è¨€å˜åŒ–:', event.detail);

      // æ˜¾ç¤ºé€šçŸ¥
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4caf50;
        color: white;
        padding: 15px;
        border-radius: 5px;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      `;
      notification.textContent = `è¯­è¨€å·²åˆ‡æ¢åˆ°: ${event.detail.language}`;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.remove();
      }, 3000);
    });
  </script>
</body>
</html>